<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vaccine Reminder</title>
    <!-- Tailwind CSS for modern styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts for better typography -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Custom styles for animations and specific elements */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Softer background color */
        }
        .view {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }
        .view.active {
            display: flex; /* Changed to flex for centering */
        }
        .form-wrapper {
            display: none;
            animation: fadeIn 0.4s ease-in-out;
        }
        .form-wrapper.active {
            display: block;
        }
        .modal {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }
        .modal.active {
            display: flex;
        }
        .modal-content {
            animation: slideInUp 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideInUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        /* Wavy animation for auth screen */
        @keyframes gentle-wave {
          0%, 100% { transform: translateY(0) rotate(0deg); }
          50% { transform: translateY(-25px) rotate(2deg); }
        }
        #wavy-svg {
            animation: gentle-wave 12s ease-in-out infinite;
            will-change: transform;
        }
        /* Custom notification styling */
        #notification {
            transition: transform 0.5s ease-in-out, opacity 0.5s ease-in-out;
            transform: translateY(-100%);
            opacity: 0;
        }
        #notification.show {
            transform: translateY(0);
            opacity: 1;
        }
    </style>
</head>
<body class="antialiased text-slate-700">

    <!-- Notification element for feedback -->
    <div id="notification" class="fixed top-5 right-5 z-50 p-4 rounded-lg shadow-lg text-white max-w-sm">
        <p id="notificationMessage"></p>
    </div>

    <!-- Auth View (replaces old login/signup views) -->
    <div id="authView" class="view active w-full min-h-screen items-center justify-center p-4">
        <div class="w-full max-w-4xl bg-white rounded-2xl shadow-2xl overflow-hidden grid md:grid-cols-2">
            <!-- Left Panel with Wavy Background -->
            <div class="relative hidden md:block bg-blue-600 p-8 text-white">
                <div class="absolute inset-0 overflow-hidden">
                    <svg id="wavy-svg" class="absolute h-full w-auto" style="left: -50%; top: -10%;" viewBox="0 0 800 800" xmlns="http://www.w3.org/2000/svg">
                        <path d="M 0 800 L 800 800 L 800 0 C 600 200, 400 0, 200 200 C 0 400, 0 800, 0 800 Z" fill="#4785FF" fill-opacity="0.6"/>
                        <path d="M 0 800 L 800 800 L 800 0 C 700 150, 350 50, 200 250 C 50 450, 0 800, 0 800 Z" fill="#3B82F6"/>
                    </svg>
                </div>
                <div class="relative z-10 flex flex-col justify-between h-full">
                    <div>
                        <h2 class="text-3xl font-bold">Vaccine Guard</h2>
                        <p class="mt-2 text-blue-200">Your family's health, simplified.</p>
                    </div>
                    <svg viewBox="0 0 200 200" class="w-full max-w-xs mx-auto">
                        <path d="M100 20 C144.18 20 180 55.82 180 100 C180 144.18 144.18 180 100 180 C55.82 180 20 144.18 20 100 C20 55.82 55.82 20 100 20 Z" fill="#fff" opacity="0.1"/>
                        <path d="M100,30 a70,70 0 1,0 0,140 a70,70 0 1,0 0,-140" fill="none" stroke="#fff" stroke-width="4" stroke-dasharray="10 10" transform-origin="center" class="animate-spin" style="animation-duration: 20s;"/>
                        <rect x="90" y="60" width="20" height="80" rx="5" fill="#fff"/>
                        <rect x="60" y="90" width="80" height="20" rx="5" fill="#fff"/>
                    </svg>
                    <p class="text-xs text-blue-300">Â© 2025 Vaccine Reminder. All rights reserved.</p>
                </div>
            </div>
            <!-- Right Panel with Forms -->
            <div class="p-8 flex flex-col justify-center">
                <!-- Login Form Wrapper -->
                <div id="loginFormWrapper" class="form-wrapper active">
                    <h1 class="text-3xl font-bold text-slate-800 mb-2">Welcome Back!</h1>
                    <p class="text-slate-500 mb-8">Login to manage your reminders.</p>
                    <form id="loginForm">
                        <div class="mb-4">
                            <label for="loginEmail" class="block text-sm font-medium text-slate-600 mb-1">Email</label>
                            <input type="email" id="loginEmail" class="w-full px-4 py-2 bg-slate-50 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all" required>
                        </div>
                        <div class="mb-6">
                            <label for="loginPassword" class="block text-sm font-medium text-slate-600 mb-1">Password</label>
                            <input type="password" id="loginPassword" class="w-full px-4 py-2 bg-slate-50 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all" required>
                        </div>
                        <p id="loginErrorMessage" class="text-red-500 text-center text-sm mb-4 min-h-[1.25rem]"></p>
                        <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition-transform transform hover:scale-105">Login</button>
                    </form>
                    <p class="text-center text-sm text-slate-500 mt-6">
                        Don't have an account? <a href="#" id="showSignupLink" class="font-medium text-blue-600 hover:underline">Sign Up here</a>
                    </p>
                </div>
                <!-- Signup Form Wrapper -->
                <div id="signupFormWrapper" class="form-wrapper">
                    <h1 class="text-3xl font-bold text-slate-800 mb-2">Create Account</h1>
                    <p class="text-slate-500 mb-8">Start tracking vaccinations today.</p>
                    <form id="signupForm">
                        <div class="mb-4">
                            <label for="signupName" class="block text-sm font-medium text-slate-600 mb-1">Full Name</label>
                            <input type="text" id="signupName" class="w-full px-4 py-2 bg-slate-50 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all" required>
                        </div>
                        <div class="mb-4">
                            <label for="signupEmail" class="block text-sm font-medium text-slate-600 mb-1">Email</label>
                            <input type="email" id="signupEmail" class="w-full px-4 py-2 bg-slate-50 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all" required>
                        </div>
                        <div class="mb-6">
                            <label for="signupPassword" class="block text-sm font-medium text-slate-600 mb-1">Password</label>
                            <input type="password" id="signupPassword" class="w-full px-4 py-2 bg-slate-50 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all" required>
                        </div>
                        <p id="signupMessage" class="text-red-500 text-center text-sm mb-4 min-h-[1.25rem]"></p>
                        <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition-transform transform hover:scale-105">Sign Up</button>
                    </form>
                    <p class="text-center text-sm text-slate-500 mt-6">
                        Already have an account? <a href="#" id="showLoginLink" class="font-medium text-blue-600 hover:underline">Login here</a>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard View -->
    <div id="dashboardView" class="view w-full max-w-5xl mx-auto p-4">
        <div class="w-full">
            <header class="flex flex-wrap justify-between items-center mb-8 gap-4">
                <h1 class="text-4xl font-bold text-slate-800">Dashboard</h1>
                <button id="logoutButton" class="bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-bold py-2 px-4 rounded-lg transition-all shadow-md hover:shadow-lg flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>
                    Logout
                </button>
            </header>
            <div class="mb-8">
                <button id="openAddChildModal" class="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-3 px-5 rounded-lg transition-transform transform hover:scale-105 flex items-center shadow-md hover:shadow-lg">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                    Add New Child
                </button>
            </div>
            <div id="dashboardContent" class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Child cards will be dynamically inserted here -->
            </div>
        </div>
    </div>

    <!-- Modals remain the same -->
    <div id="addChildModal" class="modal fixed inset-0 bg-black bg-opacity-50 items-center justify-center p-4">
        <div class="modal-content bg-white p-8 rounded-2xl shadow-lg w-full max-w-md">
            <h2 class="text-2xl font-bold text-slate-800 mb-6">Add a New Child</h2>
            <form id="addChildForm">
                <div class="mb-4">
                    <label for="childName" class="block text-sm font-medium text-slate-600 mb-1">Child's Name</label>
                    <input type="text" id="childName" class="w-full px-4 py-2 bg-slate-50 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                </div>
                <div class="mb-6">
                    <label for="childDob" class="block text-sm font-medium text-slate-600 mb-1">Date of Birth</label>
                    <input type="date" id="childDob" class="w-full px-4 py-2 bg-slate-50 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                </div>
                <p id="addChildError" class="text-red-500 text-center text-sm mb-4 min-h-[1.25rem]"></p>
                <div class="flex justify-end space-x-4">
                    <button type="button" class="close-modal-btn px-6 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 font-medium rounded-lg transition-colors">Cancel</button>
                    <button type="submit" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors">Add Child</button>
                </div>
            </form>
        </div>
    </div>
    
    <div id="addScheduleModal" class="modal fixed inset-0 bg-black bg-opacity-50 items-center justify-center p-4">
        <div class="modal-content bg-white p-8 rounded-2xl shadow-lg w-full max-w-md">
            <h2 class="text-2xl font-bold text-slate-800 mb-6">Add Vaccine Schedule</h2>
            <form id="addScheduleForm">
                <input type="hidden" id="scheduleChildId">
                <div class="mb-4">
                    <label for="vaccineId" class="block text-sm font-medium text-slate-600 mb-1">Vaccine ID</label>
                    <input type="number" id="vaccineId" class="w-full px-4 py-2 bg-slate-50 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., 1 for BCG" required>
                </div>
                <div class="mb-6">
                    <label for="scheduledDate" class="block text-sm font-medium text-slate-600 mb-1">Scheduled Date</label>
                    <input type="date" id="scheduledDate" class="w-full px-4 py-2 bg-slate-50 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                </div>
                <p id="addScheduleError" class="text-red-500 text-center text-sm mb-4 min-h-[1.25rem]"></p>
                <div class="flex justify-end space-x-4">
                    <button type="button" class="close-modal-btn px-6 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 font-medium rounded-lg transition-colors">Cancel</button>
                    <button type="submit" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors">Add Schedule</button>
                </div>
            </form>
        </div>
    </div>


    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const API_BASE_URL = 'http://localhost:8080';

        // --- DOM Elements ---
        const views = document.querySelectorAll('.view');
        const authView = document.getElementById('authView');
        const dashboardView = document.getElementById('dashboardView');
        
        const loginFormWrapper = document.getElementById('loginFormWrapper');
        const signupFormWrapper = document.getElementById('signupFormWrapper');

        const loginForm = document.getElementById('loginForm');
        const signupForm = document.getElementById('signupForm');
        
        const showSignupLink = document.getElementById('showSignupLink');
        const showLoginLink = document.getElementById('showLoginLink');

        const logoutButton = document.getElementById('logoutButton');
        const dashboardContent = document.getElementById('dashboardContent');

        // Modals
        const addChildModal = document.getElementById('addChildModal');
        const addScheduleModal = document.getElementById('addScheduleModal');
        const openAddChildModalBtn = document.getElementById('openAddChildModal');
        const closeModalBtns = document.querySelectorAll('.close-modal-btn');
        
        // Modal Forms
        const addChildForm = document.getElementById('addChildForm');
        const addScheduleForm = document.getElementById('addScheduleForm');

        // Error Messages
        const loginErrorMessage = document.getElementById('loginErrorMessage');
        const signupMessage = document.getElementById('signupMessage');
        const addChildError = document.getElementById('addChildError');
        const addScheduleError = document.getElementById('addScheduleError');
        
        // Notification
        const notification = document.getElementById('notification');
        const notificationMessage = document.getElementById('notificationMessage');

        // --- Navigation Logic ---
        const showView = (viewId) => {
            views.forEach(view => view.classList.remove('active'));
            document.getElementById(viewId).classList.add('active');
        };
        
        const showAuthForm = (formWrapperId) => {
            document.querySelectorAll('.form-wrapper').forEach(fw => fw.classList.remove('active'));
            document.getElementById(formWrapperId).classList.add('active');
        };

        showSignupLink.addEventListener('click', (e) => {
            e.preventDefault();
            showAuthForm('signupFormWrapper');
        });

        showLoginLink.addEventListener('click', (e) => {
            e.preventDefault();
            showAuthForm('loginFormWrapper');
        });
        
        // --- Modal Logic ---
        const openModal = (modal) => modal.classList.add('active');
        const closeModal = (modal) => modal.classList.remove('active');

        openAddChildModalBtn.addEventListener('click', () => openModal(addChildModal));
        closeModalBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                closeModal(addChildModal);
                closeModal(addScheduleModal);
            });
        });
        
        // All other JS functions (showNotification, apiRequest, isTokenExpired, initializeApp, form submissions, dashboard logic)
        // remain exactly the same as the previous version, as the core functionality is unchanged.
        // The only change is how the initial views and forms are toggled.

        // --- Notification Logic ---
        const showNotification = (message, isError = false) => {
            notificationMessage.textContent = message;
            notification.className = `fixed top-5 right-5 z-50 p-4 rounded-lg shadow-lg text-white max-w-sm ${isError ? 'bg-red-500' : 'bg-green-500'}`;
            notification.classList.add('show');
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        };

        // --- API & Auth Logic ---
        const apiRequest = async (endpoint, options = {}) => {
            try {
                const token = localStorage.getItem('token');
                const headers = {
                    'Content-Type': 'application/json',
                    ...options.headers,
                };
                if (token) {
                    headers['Authorization'] = `Bearer ${token}`;
                }

                const response = await fetch(`${API_BASE_URL}${endpoint}`, {
                    ...options,
                    headers,
                });

                if (response.status === 403) {
                    localStorage.removeItem('token');
                    showView('authView');
                    showAuthForm('loginFormWrapper');
                    showNotification('Session expired. Please log in again.', true);
                    throw new Error('Session expired'); // Stop further execution
                }

                const responseText = await response.text();
                let data;
                try {
                    if (!responseText) {
                        data = null;
                    } else {
                        data = JSON.parse(responseText);
                    }
                } catch (e) {
                    data = responseText;
                }

                if (!response.ok) {
                    const errorMessage = (typeof data === 'object' && data && data.message) ? data.message : (typeof data === 'string' && data) ? data : `Request failed with status ${response.status}`;
                    throw new Error(errorMessage);
                }

                return data;
            } catch (err) {
                if (err.message === 'Session expired') {
                    throw err; 
                }

                console.error(`API Request Error for endpoint ${endpoint}:`, err);
                let userMessage = 'An unexpected error occurred. Please try again.';
                if (err instanceof TypeError && err.message.includes('Failed to fetch')) {
                    userMessage = 'Could not connect to the server. Please make sure the backend is running.';
                } else if (err.message) {
                    userMessage = err.message;
                }
                throw new Error(userMessage);
            }
        };

        const isTokenExpired = (token) => {
            try {
                const payload = JSON.parse(atob(token.split('.')[1]));
                return Date.now() >= payload.exp * 1000;
            } catch {
                return true;
            }
        };

        const initializeApp = () => {
            const token = localStorage.getItem('token');
            if (token && !isTokenExpired(token)) {
                showView('dashboardView');
                fetchDashboardData();
            } else {
                localStorage.removeItem('token');
                showView('authView');
                showAuthForm('loginFormWrapper');
            }
        };

        // Login
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            loginErrorMessage.textContent = '';
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            try {
                const data = await apiRequest('/auth/login', {
                    method: 'POST',
                    body: JSON.stringify({ email, password })
                });
                
                if (data && data.token) {
                    localStorage.setItem('token', data.token);
                    showView('dashboardView');
                    fetchDashboardData();
                } else {
                    throw new Error('Login failed: No token received.');
                }
            } catch (err) {
                loginErrorMessage.textContent = err.message;
            }
        });

        // Signup
        signupForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            signupMessage.textContent = '';
            const name = document.getElementById('signupName').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;

            try {
                await apiRequest('/auth/signup', {
                    method: 'POST',
                    body: JSON.stringify({ name, email, password }),
                });
                
                showNotification('Registration successful! Please log in.');
                signupForm.reset();
                showAuthForm('loginFormWrapper');

            } catch (error) {
                signupMessage.textContent = error.message;
            }
        });

        // Logout
        logoutButton.addEventListener('click', () => {
            localStorage.removeItem('token');
            dashboardContent.innerHTML = '';
            showView('authView');
            showAuthForm('loginFormWrapper');
        });

        // --- Dashboard Logic ---
        const fetchDashboardData = async () => {
            dashboardContent.innerHTML = `<p class="text-center text-slate-500 lg:col-span-2">Loading your data...</p>`;
            try {
                const children = await apiRequest('/child');
                dashboardContent.innerHTML = '';

                if (!children || children.length === 0) {
                    dashboardContent.innerHTML = `
                    <div class="lg:col-span-2 text-center text-slate-500 bg-white p-8 rounded-2xl shadow-sm">
                        <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                          <path vector-effect="non-scaling-stroke" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z" />
                        </svg>
                        <h3 class="mt-2 text-lg font-medium text-gray-900">No children found</h3>
                        <p class="mt-1 text-sm text-gray-500">Get started by adding a new child.</p>
                    </div>`;
                    return;
                }

                children.forEach(child => renderChildCard(child));
            } catch (err) {
                if (err.message !== 'Session expired') {
                    dashboardContent.innerHTML = `<p class="error text-center text-red-500 lg:col-span-2">${err.message}</p>`;
                }
            }
        };

        const renderChildCard = (child) => {
            const card = document.createElement('div');
            card.className = 'child-card bg-white p-6 rounded-2xl shadow-md transition-all duration-300 hover:shadow-xl hover:-translate-y-1 border-l-4 border-blue-500';
            
            let schedulesHtml = '<div class="space-y-3 mt-4">';
            if (!child.schedules || child.schedules.length === 0) {
                schedulesHtml = '<p class="text-sm text-slate-500 mt-4">No vaccine schedules added yet.</p>';
            } else {
                 child.schedules.forEach(s => {
                    const statusClass = s.completed ? 'bg-green-100 text-green-700' : 'bg-yellow-100 text-yellow-700';
                    const statusText = s.completed ? 'Completed' : 'Pending';

                    schedulesHtml += `
                        <div class="flex items-center justify-between p-3 rounded-lg bg-slate-50 hover:bg-slate-100">
                            <div>
                                <strong class="text-slate-800">${s.vaccineName || 'Unknown Vaccine'}</strong>
                                <span class="text-sm text-slate-500 ml-2">Due: ${s.scheduledDate}</span>
                            </div>
                            <div class="flex items-center space-x-3">
                                <span class="text-xs font-semibold px-2 py-1 rounded-full ${statusClass}">${statusText}</span>
                                ${!s.completed ? `<button class="mark-completed-btn text-xs bg-blue-500 hover:bg-blue-600 text-white font-semibold py-1 px-3 rounded-full transition-colors" data-id="${s.id}">Mark Done</button>` : ''}
                            </div>
                        </div>`;
                });
                schedulesHtml += '</div>';
            }

            card.innerHTML = `
                <div class="flex justify-between items-start">
                    <div>
                        <h3 class="text-xl font-bold text-slate-800">${child.name}</h3>
                        <p class="text-sm text-slate-500">Date of Birth: ${child.dob}</p>
                    </div>
                    <button class="add-schedule-btn text-sm bg-indigo-500 hover:bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg transition-colors flex items-center" data-child-id="${child.id}">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" /></svg>
                        Add
                    </button>
                </div>
                <hr class="my-4">
                <h4 class="text-md font-semibold text-slate-700 mb-2">Schedules</h4>
                ${schedulesHtml}
            `;
            dashboardContent.appendChild(card);
        };
        
        // --- Event Delegation for Dynamic Content ---
        dashboardContent.addEventListener('click', async (e) => {
            const markBtn = e.target.closest('.mark-completed-btn');
            const addBtn = e.target.closest('.add-schedule-btn');

            if (markBtn) {
                const scheduleId = markBtn.getAttribute('data-id');
                try {
                     await apiRequest(`/schedule/${scheduleId}`, { method: 'PUT' });
                    showNotification('Schedule updated successfully!');
                    fetchDashboardData();
                } catch (err) {
                    if (err.message !== 'Session expired') {
                      showNotification(`Error: ${err.message}`, true);
                    }
                }
            }

            if (addBtn) {
                const childId = addBtn.getAttribute('data-child-id');
                document.getElementById('scheduleChildId').value = childId;
                addScheduleForm.reset();
                addScheduleError.textContent = '';
                openModal(addScheduleModal);
            }
        });

        // --- Form Submissions ---
        addChildForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            addChildError.textContent = '';
            const name = document.getElementById('childName').value;
            const dob = document.getElementById('childDob').value;

            try {
                await apiRequest('/child', {
                    method: 'POST',
                    body: JSON.stringify({ name, dob })
                });
                
                showNotification('Child added successfully!');
                addChildForm.reset();
                closeModal(addChildModal);
                fetchDashboardData();  
            } catch (err) {
                if (err.message !== 'Session expired') {
                    addChildError.textContent = err.message;
                }
            }
        });

        addScheduleForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            addScheduleError.textContent = '';
            const childId = document.getElementById('scheduleChildId').value;
            const vaccineId = document.getElementById('vaccineId').value;
            const scheduledDate = document.getElementById('scheduledDate').value;
            
            try {
                await apiRequest('/schedule', {
                    method: 'POST',
                    body: JSON.stringify({
                        child: { id: parseInt(childId) },
                        vaccine: { id: parseInt(vaccineId) },
                        scheduledDate,
                        completed: false
                    })
                });
                
                showNotification('Schedule added successfully!');
                closeModal(addScheduleModal);
                fetchDashboardData();
            } catch (err) {
                 if (err.message !== 'Session expired') {
                    addScheduleError.textContent = err.message;
                 }
            }
        });

        // Initialize the app on page load
        initializeApp();
    });
    </script>
</body>
</html>

